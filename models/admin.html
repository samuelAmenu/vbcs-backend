<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VBCS Command Center</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* --- MERGED CSS FROM FILE #5 --- */
        :root { --owner-theme: #6a1b9a; --active-bg: #e0f8e9; --active-text: #009639; }
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar */
        .sidebar { width: 260px; background: #1a1a1a; color: white; display: flex; flex-direction: column; flex-shrink: 0; }
        .brand { padding: 25px; font-size: 20px; font-weight: bold; border-bottom: 1px solid #333; letter-spacing: 1px; }
        .brand i { color: var(--owner-theme); margin-right: 10px; }
        .menu { padding-top: 20px; flex: 1; }
        .nav-link { padding: 15px 25px; color: #aaa; cursor: pointer; display: flex; align-items: center; text-decoration: none; transition: 0.2s; }
        .nav-link:hover, .nav-link.active { background: #333; color: white; border-left: 4px solid var(--owner-theme); }
        .nav-link i { width: 30px; }
        
        /* Main Content */
        .main { flex: 1; display: flex; flex-direction: column; overflow: hidden; }
        .content-scroll { flex: 1; padding: 30px; overflow-y: auto; }
        .header { display: flex; justify-content: space-between; margin-bottom: 30px; align-items: center; }
        
        /* Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); border-bottom: 4px solid var(--owner-theme); }
        .stat-card h3 { margin: 0; font-size: 13px; color: #666; text-transform: uppercase; }
        .stat-card .val { font-size: 28px; font-weight: bold; margin-top: 10px; color: #333; }
        
        /* Tables */
        .table-wrap { background: white; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05); overflow: hidden; }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 15px 20px; text-align: left; border-bottom: 1px solid #eee; }
        th { background: #f8f9fa; font-weight: 600; font-size: 12px; text-transform: uppercase; color: #555; }
        
        /* Login */
        #login-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #1a1a1a; z-index: 999; display: flex; justify-content: center; align-items: center; }
        .login-box { background: white; padding: 40px; border-radius: 10px; width: 320px; text-align: center; }
        .login-box input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px; box-sizing: border-box; }
        .btn-primary { background: var(--owner-theme); color: white; border: none; padding: 12px; width: 100%; border-radius: 5px; font-weight: bold; cursor: pointer; }
        
        /* Modals & Uploads */
        .page { display: none; }
        .page.active { display: block; }
        .status-badge { padding: 5px 10px; border-radius: 15px; font-size: 11px; font-weight: bold; }
        .status-active { background: #e0f8e9; color: #009639; }
        .status-warning { background: #fff3cd; color: #856404; }
        
        .upload-section { background: white; padding: 30px; border-radius: 10px; text-align: center; border: 2px dashed #ddd; margin-bottom: 20px; }
    </style>
</head>
<body>

    <div id="login-container">
        <div class="login-box">
            <h2 style="color:#333; margin-top:0;">VBCS Owner</h2>
            <p style="color:#666; font-size:14px;">Restricted Access</p>
            <input type="text" id="username" placeholder="Username">
            <input type="password" id="password" placeholder="Password">
            <button class="btn-primary" id="login-btn">Secure Login</button>
            <p id="login-error" style="color:red; font-size:13px; margin-top:10px;"></p>
        </div>
    </div>

    <div id="dashboard-container" style="display:none; width:100%; height:100%;">
        
        <div class="sidebar">
            <div class="brand"><i class="fas fa-shield-alt"></i> COMMAND</div>
            <div class="menu">
                <a href="#" class="nav-link active" data-page="dashboard"><i class="fas fa-chart-line"></i> Dashboard</a>
                <a href="#" class="nav-link" data-page="enterprises"><i class="fas fa-building"></i> Enterprises (B2B)</a>
                <a href="#" class="nav-link" data-page="directory"><i class="fas fa-address-book"></i> Directory</a>
                <a href="#" class="nav-link" data-page="fraud"><i class="fas fa-exclamation-triangle"></i> Fraud Intel</a>
                <a href="#" class="nav-link" data-page="system-health"><i class="fas fa-server"></i> System Health</a>
            </div>
            <div style="padding:20px;">
                <a href="#" id="logout-btn" class="nav-link" style="color:#e74c3c;"><i class="fas fa-sign-out-alt"></i> Logout</a>
            </div>
        </div>

        <div class="main">
            <div class="content-scroll">
                
                <div id="dashboard-page" class="page active">
                    <div class="header"><h1>System Overview</h1></div>
                    <div class="stats-grid">
                        <div class="stat-card"><h3>Monthly Revenue</h3><div class="val" id="total-revenue">$0</div></div>
                        <div class="stat-card"><h3>Enterprises</h3><div class="val" id="total-enterprises">0</div></div>
                        <div class="stat-card"><h3>Subscribers</h3><div class="val" id="total-subscribers">0</div></div>
                        <div class="stat-card"><h3>Threats Blocked</h3><div class="val" id="spam-reports">0</div></div>
                    </div>
                    <div class="table-wrap" style="padding:20px;">
                        <canvas id="mainRevenueChart" height="100"></canvas>
                    </div>
                </div>

                <div id="enterprises-page" class="page">
                    <div class="header"><h1>Enterprise Management</h1></div>
                    <div class="table-wrap">
                        <table class="data-table">
                            <thead><tr><th>Company</th><th>Tier</th><th>Status</th><th>Monthly Bill</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div id="directory-page" class="page">
                    <div class="header"><h1>Directory Manager</h1></div>
                    
                    <div class="upload-section">
                        <i class="fas fa-cloud-upload-alt" style="font-size:40px; color:#aaa; margin-bottom:10px;"></i>
                        <h3>Bulk Import CSV</h3>
                        <p style="color:#888; font-size:13px;">Format: Name, Phone, Category</p>
                        <input type="file" id="directory-file-input" accept=".csv" style="margin:10px auto; display:block;">
                        <button id="upload-btn" class="btn-primary" style="width:auto; padding:8px 20px;">Upload Database</button>
                        <p id="upload-status" style="margin-top:10px; font-weight:bold;"></p>
                    </div>

                    <div class="table-wrap">
                        <table id="directory-table" class="data-table">
                            <thead><tr><th>Company</th><th>Phone</th><th>Category</th><th>Status</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div id="fraud-page" class="page">
                    <div class="header">
                        <h1>Fraud Reports</h1>
                        <button id="btn-refresh-reports" class="btn-primary" style="width:auto;">Refresh</button>
                    </div>
                    <div class="table-wrap">
                        <table class="data-table">
                            <thead><tr><th>Reported #</th><th>Reason</th><th>Comments</th><th>Date</th><th>Action</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

                <div id="system-health-page" class="page">
                    <div class="header"><h1>System Diagnostics</h1></div>
                    <div class="table-wrap">
                        <table class="data-table">
                            <thead><tr><th>Service</th><th>Status</th></tr></thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Updated to point to your live backend
            const API_BASE_URL = 'https://vbcs-backend-1.onrender.com'; 

            const loginContainer = document.getElementById('login-container');
            const dashboardContainer = document.getElementById('dashboard-container');
            
            // --- LOGIN LOGIC ---
            document.getElementById('login-btn').addEventListener('click', async () => {
                const u = document.getElementById('username').value;
                const p = document.getElementById('password').value;
                const btn = document.getElementById('login-btn');
                
                btn.innerText = "Authenticating...";
                
                try {
                    const res = await fetch(`${API_BASE_URL}/api/v1/owner/login`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({ username: u, password: p })
                    });
                    const data = await res.json();
                    
                    if(data.success) {
                        loginContainer.style.display = 'none';
                        dashboardContainer.style.display = 'flex';
                        loadDashboardStats();
                    } else {
                        document.getElementById('login-error').innerText = "Invalid Credentials";
                    }
                } catch(e) {
                    document.getElementById('login-error').innerText = "Server Connection Error";
                }
                btn.innerText = "Secure Login";
            });

            // --- NAVIGATION ---
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    if(link.id === 'logout-btn') { location.reload(); return; }

                    document.querySelectorAll('.nav-link').forEach(l => l.classList.remove('active'));
                    link.classList.add('active');

                    document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                    const pageId = link.getAttribute('data-page');
                    document.getElementById(pageId + '-page').classList.add('active');

                    // Load Data
                    if(pageId === 'dashboard') loadDashboardStats();
                    if(pageId === 'enterprises') loadEnterprises();
                    if(pageId === 'directory') loadDirectory();
                    if(pageId === 'fraud') loadFraud();
                    if(pageId === 'system-health') loadHealth();
                });
            });

            // --- LOADERS ---
            async function loadDashboardStats() {
                const res = await fetch(`${API_BASE_URL}/api/v1/owner/stats`);
                const s = await res.json();
                document.getElementById('total-revenue').innerText = `$${s.totalMonthlyRevenue}`;
                document.getElementById('total-enterprises').innerText = s.totalEnterprises;
                document.getElementById('total-subscribers').innerText = s.totalB2CSubscribers;
                document.getElementById('spam-reports').innerText = s.spamReports;
                renderChart();
            }

            async function loadEnterprises() {
                const res = await fetch(`${API_BASE_URL}/api/v1/owner/enterprises`);
                const data = await res.json();
                const tbody = document.querySelector('#enterprises-page tbody');
                tbody.innerHTML = data.map(e => `<tr><td>${e.companyName}</td><td>${e.tier}</td><td><span class="status-badge status-active">${e.status}</span></td><td>$${e.monthlyBill}</td></tr>`).join('');
            }

            async function loadDirectory() {
                const res = await fetch(`${API_BASE_URL}/api/v1/owner/directory`);
                const data = await res.json();
                const tbody = document.querySelector('#directory-table tbody');
                tbody.innerHTML = data.map(d => `<tr><td>${d.companyName}</td><td>${d.phoneNumber}</td><td>${d.category}</td><td>Active</td></tr>`).join('');
            }

            // --- UPLOAD LOGIC ---
            document.getElementById('upload-btn').addEventListener('click', async () => {
                const file = document.getElementById('directory-file-input').files[0];
                if(!file) return alert("Select CSV");
                
                const formData = new FormData();
                formData.append('file', file);
                document.getElementById('upload-status').innerText = "Uploading...";
                
                const res = await fetch(`${API_BASE_URL}/api/v1/owner/directory-upload`, { method:'POST', body:formData });
                const d = await res.json();
                document.getElementById('upload-status').innerText = d.message;
                loadDirectory();
            });

            async function loadFraud() {
                const res = await fetch(`${API_BASE_URL}/api/v1/owner/fraud-reports`);
                const data = await res.json();
                const tbody = document.querySelector('#fraud-page tbody');
                tbody.innerHTML = data.map(r => `
                    <tr>
                        <td style="color:#e74c3c; font-weight:bold;">${r.number}</td>
                        <td>${r.reason}</td>
                        <td>${r.comments || '-'}</td>
                        <td>${new Date(r.createdAt).toLocaleDateString()}</td>
                        <td><button onclick="suspend('${r.number}')" style="background:#e74c3c; color:white; border:none; border-radius:4px; cursor:pointer;">Suspend</button></td>
                    </tr>`).join('');
            }

            window.suspend = async (num) => {
                if(!confirm(`Suspend ${num}?`)) return;
                await fetch(`${API_BASE_URL}/api/v1/owner/suspend-number`, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ number: num })
                });
                alert("Number Suspended");
                loadFraud();
            };

            async function loadHealth() {
                const res = await fetch(`${API_BASE_URL}/api/v1/owner/system-health`);
                const data = await res.json();
                document.querySelector('#system-health-page tbody').innerHTML = data.map(h => `<tr><td>${h.service}</td><td><span class="status-badge status-active">${h.status}</span></td></tr>`).join('');
            }

            function renderChart() {
                if(window.myChart) return;
                const ctx = document.getElementById('mainRevenueChart');
                window.myChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{ label: 'Revenue', data: [12000, 19000, 30000, 50000, 40000, 60000], borderColor: '#6a1b9a', tension: 0.4 }]
                    }
                });
            }
        });
    </script>
</body>
</html>